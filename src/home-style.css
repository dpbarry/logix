#main-header {
  width: min-content;

  position: relative;
  left: 50%;
  transform: translateX(-50%);
  top: 7px;

  margin: 0;
  cursor: pointer;

  color: var(--baseColor);
  
  font-family: computer modern serif;
  font-weight: bolder;
  font-size: 3.1rem;
}

.dialog_button.home {
  position: absolute;
  top: clamp(1rem, 2vmin, 1.75rem); 
  height: 38px;
  width: 38px;
}

#settings.home {
  background: url("../assets/SETTINGS.svg");
  right: clamp(0.5rem, 2.5vmin, 1.5rem); 
}

#about {
  background: url("../assets/INFO.svg");
  left: clamp(0.5rem, 2.5vmin, 1.5rem); 
}
:root.dark #mcgill { filter: invert(0.9); }

#about_dialog {
  
  #github {
    background: url("../assets/INVERTOCAT.svg");
    background-size: 100%;
    background-repeat: no-repeat;
    width: 30px;
    height: 30px;
    cursor: pointer;
    color: hsl(200, 15%, 55%);
    position: absolute;
    left: 20px;
    top: 18px;
    text-align: center;
    filter: var(--hueShiftIcons);
  }

  #sources {
    display: flex;
    width: 100%;
    margin-top: 15px;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    gap: 20px;
    
    #mcgill {
      background: url("../assets/MCGILL.svg");
      background-size: 100%;
      background-repeat: no-repeat;
      width: calc(300px / 4);
      height: calc(76px / 4);
      display: block;
    }


    #wikipedia {
      background: url("../assets/WIKI.svg");
      background-size: 100%;
      background-repeat: no-repeat;
      width: calc(103px / 2);
      height: calc(94px / 2);
      display: block;
    }

    #textbook {
      background: url("../assets/TEXTBOOK.jpg");
      background-size: 100%;
      background-repeat: no-repeat;
      width: calc(67px / 2);
      height: calc(80px / 2);
      display: block;
    }
  }

  

  @media (hover: hover) and (pointer: fine) {
    #github:hover { opacity: 0.75; }
  }

  #precis {
    margin-left: 2vw;
    margin-right: 2vw;
    display:flex;
    align-items: flex-end;
    justify-content: left;
    flex-wrap: wrap;
    gap: 10px;

    h2 {
      font-size: 1.3rem;
      font-weight: 400;

      margin: 0;
      text-align: center;
    }

    a {
      cursor: pointer;
      text-decoration: underline;
      color: hsl(120 20% 60%);
      
      transition: color 0.07s;
    }

    @media (hover: hover) and (pointer: fine) {
      a:hover {
        color: hsl(120 20% 40%);
      }
    }

    hr { width: 100%;}

    p {
      font-size: 1.1rem;
      font-weight: 400;
      width: 100%;
      font-style: italic;
      margin:0;
      text-align: center;
    }

  }

}

#wrap_cards {
  width: 94vw;
  /* For box-shadow */
  padding-left: 4px;
  padding-right: 4px;

  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%,-50%);

  display: flex;
  flex-direction: row;
  gap: 15px;
  justify-content: flex-start;
  align-items: center;

  touch-action: none;
  
  scrollbar-width: none;
}


#wrap_cards > :first-child {
  margin-left: auto;
}
#wrap_cards > :last-child {
  margin-right: auto;
}

.card {
  min-width: 295px;
  max-width: 295px;
  min-height: 450px;
  max-height: 450px;
  padding: 15px;

  transition: rotate 0.15s ease-out, transform .1s, filter .1s;

  background-color: var(--card);
  border: light-dark(#DADADA, #333) 1px solid;
  border-radius: 5px;
  box-shadow: 0 0 4px #EAEAEA, 0 0px 2px  #C0C0C0, 0 7px 8px -8px #D0D0D0;

  font-family: "Source Serif 4";

  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;

  h2 {
    font-family: "Source Serif 4";
    font-size: 1.85rem;
    font-weight: 700;
    margin-top: -10px;
    margin-bottom: 8px;
    color: var(--baseColor);
  }
}

#navbar {display: none;}
@media (width < 1450px) {
  .card {
    --offset: min(calc((1450px - 100vw) / 2.8), 320px);
    position: relative;
    bottom: 0;
    margin-left: calc(-1 * var(--offset));
    backface-visibility: hidden;
  }
  
  .card:not(.upcard) {
    cursor: pointer;
    
    .level-button, .trainstage {
      pointer-events: none;
    }
    
    #wrap_cards.grabbing & {
      cursor: grabbing;
      .level-button, .trainstage {
        cursor: grabbing;
      }
    }
  }

  .upcard {
    clip-path: none;
    box-shadow: 0 0 4px #EAEAEA, 0 0px 2px  #C0C0C0, 0 7px 8px -8px #D0D0D0, 18px 0 20px -10px rgba(0,0,0,0.3), -18px 0 20px -10px rgba(0,0,0,0.3);
    cursor: grab;

    #wrap_cards.grabbing & {

      cursor: grabbing;
      .level-button, .trainstage {
        cursor: grabbing;
      }
    }
    
    &:first-child.card {
      box-shadow: 0 0 4px #EAEAEA, 0 0px 2px  #C0C0C0, 0 7px 8px -8px #D0D0D0, 18px 0 20px -10px rgba(0,0,0,0.3);
    }
    &:last-child.card {
      box-shadow: 0 0 4px #EAEAEA, 0 0px 2px  #C0C0C0, 0 7px 8px -8px #D0D0D0, -18px 0 20px -10px rgba(0,0,0,0.3);
    }
  }
  
  .card:has(~ .upcard) {
    clip-path: inset(0 0 0 -30px);
    box-shadow: -18px 0 20px -10px rgba(0,0,0,0.25);

    &:first-child {clip-path: none; box-shadow: none;}
    
    &.hover {  rotate: -4deg; }
  }
  .upcard ~ .card {
    clip-path: inset(0 -30px 0 0);
    box-shadow: 18px 0 20px -10px rgba(0,0,0,0.25);

    &:last-child {clip-path: none; box-shadow: none;}

    &.hover {  rotate: 4deg; }  }

  #wrap_cards.grabbing .card {
    &.hover { rotate: unset; }
  }

  #navbar {
    
    display: flex;
    align-items: center;
    justify-content: space-evenly;
    position: absolute;
    bottom: 75px;
    left: 50%;
    transform: translateX(-50%);
    width: clamp(100px, 40vw, 290px);

    span {
      height: 12px;
      width: 12px;
      border-radius: 100%;
      background-color: light-dark(#555, #AAA);
      box-shadow: 0 0 2px #ddd, 0 3px 3px -3px #aaa;
      
      transition: scale 0.1s, opacity 0.1s;
      cursor: pointer;
      &::before {
        content: "";
        position: relative;
        display: block;
        bottom: 0;
        height: 12px;
        width: 12px;
        scale: 3;
        cursor: pointer;
      }

      @media (hover: hover) and (pointer: fine) {
        &:hover {
          opacity: 0.65;
        }
      }
    }

    button {
      content: "";
      position: fixed;
      height: 22px;
      width: 22px;
      background: none;
      border: none;
      padding: 0;

      cursor: pointer;

      border-bottom: 8px solid light-dark(#555, #AAA);
      border-right: 8px solid light-dark(#555, #AAA);
      border-radius: 4px;

      transition: scale 0.2s cubic-bezier(0.77,0.2,0.05,1.0), opacity 0.1s;

      &::before {
        content: "";
        position: relative;
        display: block;
        bottom: 0;
        height: 22px;
        width: 22px;
        scale: 1.8;
        cursor: pointer;
      }

      @media (hover: hover) and (pointer: fine) {
        &:hover {
          opacity: 0.65;
        }
      }
    }

    #leftnav {
      left: -12px;
      rotate: 135deg;
      filter: drop-shadow(2px -2px 1px light-dark(#d8d8d8, transparent));
    }
    #rightnav {
      right: -12px;
      rotate: -45deg;
      filter: drop-shadow(-2px 2px 1px light-dark(#d8d8d8, transparent));
    }
    --op: unset;

  }


  #wrap_cards:has(#training.upcard) ~ #navbar #nav1,
  #wrap_cards:has(#normal.upcard) ~ #navbar #nav2,
  #wrap_cards:has(#difficult.upcard) ~ #navbar #nav3,
  #wrap_cards:has(#extreme.upcard) ~ #navbar #nav4
  {
    scale: 1.7;
    &::before {scale: 1.7647;}
    &:hover {
      opacity: 1;
    }
  }
  
  
  
}




.level-button {
  height: 54px;
  width: 54px;
  margin-bottom: 0;
  box-sizing: border-box;
  
  font-size: 1.75rem;
  font-weight: 315;
  
  border: 1px solid light-dark(#888, #333);
  border-radius: 3px;
  
  display: flex;
  justify-content: center;
  align-items: center;
  
  cursor: pointer;

  transition: transform 0.2s, opacity 0.2s, background 0.1s, border 0.12s, font-weight 0.12s;
}

.level-button:focus {
  border: 1px solid #555;
}

.level-button.locked.nudged {
  transform: scale(0.97) !important;
  transition: transform 0.03s;
}
.level-button.nudged {
  transform: scale(0.95) !important;
  transition: transform 0.08s;
}

#normal {
  li {
    box-shadow: 0 2px 3px hsl(55 8% 86% / 1), 0 0 2px hsl(55 8% 91% / 1);
    background: hsl(55 20% 85%);
    
    &:focus {
      background: hsl(55 25% 80%);
      box-shadow: 0 2px 3px hsl(55 8% 85% / 1), 0 0 2px hsl(55 8% 90% / 1);
    }
  }
}

#difficult {
  li {
    box-shadow: 0 2px 3px hsl(0 8% 86% / 1), 0 0 2px hsl(0 8% 91% / 1);
    background: hsl(0 20% 85%);


    &:focus {
      background: hsl(0 25% 80%);
      box-shadow: 0 2px 3px hsl(0 8% 85% / 1), 0 0 2px hsl(0 8% 90% / 1);
    }
  }
}

#extreme {
  li {
    box-shadow: 0 2px 3px hsl(300 8% 86% / 1), 0 0 2px hsl(300 8% 91% / 1);
    background: hsl(300 20% 85%);

    &:focus {
      background: hsl(300 25% 80%);
      box-shadow: 0 2px 3px hsl(300 8% 85% / 1), 0 0 2px hsl(300 8% 90% / 1);
    }
  }
}

.card:not(#training) .level-button.locked {
  opacity: 0.3;
}

#training {
  /* With chapter open, keep height the same as other cards;
     otherwise, allow it to shrink */
  transition: rotate 0.15s ease-out, transform .1s, filter .1s, min-height .1s;
  min-height: 0;
  &:has(.dropped) { min-height: 450px; }
  
  .trainstage, .level-button {
    box-shadow: 0 2px 3px hsl(120 8% 86% / 1), 0 0 2px hsl(120 8% 91% / 1);
    background: hsl(120 20% 85%);
  }

  .trainstage:focus, .level-button:focus {
    background: hsl(120 25% 80%);
    box-shadow: 0 2px 3px hsl(120 8% 85% / 1), 0 0 2px hsl(120 8% 90% / 1);
  }

  .trainstage.dropped {
    box-shadow: 0 2px 3px hsl(120 8% 86% / 1), 0 0 2px hsl(120 8% 91% / 1);
    background: hsl(120 20% 80%);
    border: 1px solid #888;

    & + * > .level-button.locked {
      opacity: 0.3;
    }
  }
}

.trainstage {
  width: calc(100% - 11px - 1px); /* Align edge with droplist */
  height: 50px;
  padding-left: 11px;
  margin-bottom: 10px;
  
  display: flex;
  flex-direction: row;
  justify-content: flex-start;
  align-items: center;

  font-size: 1.45rem;
  font-weight: 435;

  border: 1px solid light-dark(#AAA, #777);
  border-radius: 2px;
  box-shadow: 0 2px 3px #DFDFDF, 0 0 2px #EEE;

  list-style-type: none;
  cursor: pointer;

  transition: background .15s ease, box-shadow .15s ease-out, top .3s ease-out, border .15s;

  &:last-of-type { margin-bottom: 0px; }
}

:root.dark .level-button, :root.dark .trainstage {
  filter: saturate(3.6) brightness(0.7);
}

@media (hover: hover) and (pointer: fine) {
  .trainstage:hover {
    border: 1px solid #888;
  }

  .level-button:hover {
    border: 1px solid #555;
  }

  #training .trainstage:hover, #training .level-button:hover {
    background: hsl(120 20% 80%);
    box-shadow: 0 2px 3px hsl(120 8% 85% / 1), 0 0 2px hsl(120 8% 90% / 1);
  }

  #normal .level-button:hover {
    background: hsl(55 20% 80%);
    box-shadow: 0 2px 3px hsl(55 8% 85% / 1), 0 0 2px hsl(55 8% 90% / 1);
  }

  #difficult .level-button:hover {
    background: hsl(0 20% 80%);
    box-shadow: 0 2px 3px hsl(0 8% 85% / 1), 0 0 2px hsl(0 8% 90% / 1);
  }

  #extreme .level-button:hover {
    background: hsl(300 20% 80%);
    box-shadow: 0 2px 3px hsl(300 8% 85% / 1), 0 0 2px hsl(300 8% 90% / 1);
  }
}



.dropdown_chevron {
  position: relative;
  right: 15px;
  bottom: 3px;
  margin-left: auto;
  transition: top 0.2s cubic-bezier(0.77,0.2,0.05,1.0);
}

.dropdown_chevron:before {
  content: "";

  display: inline-block;
  height: 12px;
  width: 12px;

  border-bottom: 2px solid #000000;
  border-right: 2px solid #000000;
  border-radius: 0px;

  rotate: 45deg;
  transition: transform 0.2s cubic-bezier(0.77,0.2,0.05,1.0);
}

.trainstage.dropped .dropdown_chevron:before {
  transform: rotate(180deg);
}
.trainstage.dropped .dropdown_chevron {
  /* Counteract apparent upwards-shift caused by rotating chevron */
  top: 4px;
}

.droplist, .campaignlist {
  padding: 0;
  
  display: flex;
  flex-wrap: wrap;
  justify-content: flex-start;
  gap: 6px;

  list-style-type: none;
}

.campaignlist {
  margin-bottom: 0;

  overflow: visibile; /* Change when more levels */
}

.droplist {
  max-height: 0px;
  margin-bottom: 0;

  will-change: max-height, margin-bottom;
  transition: max-height 0.2s, margin-bottom 0.2s;

  .level-button {
    transform: translateY(-20px);
    opacity: 0;
  }
}

.trainstage:last-of-type.dropped {
  margin-bottom: 15px;
}

.trainstage.dropped + .droplist {
  max-height: 200px;
  margin-bottom: 11px;

  .level-button {
    transform: translateY(0);
    opacity: 1;
  }
}

.trainstage:not(.dropped) + .droplist {
  li { pointer-events: none; cursor: default; }
}


